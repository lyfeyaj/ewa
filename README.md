EWA (å¾®ä¿¡å°ç¨‹åºå¢å¼ºå¼€å‘å·¥å…·)
=========================

Enhanced Wechat App Development Toolkit (å¾®ä¿¡å°ç¨‹åºå¢å¼ºå¼€å‘å·¥å…·)

## ä¸ºä»€ä¹ˆå¼€å‘è¿™ä¸ªå·¥å…·ï¼Ÿ

åŒå€¦äº†ä¸åœçš„å¯¹æ¯” [wepy](https://github.com/Tencent/wepy) æˆ–è€… [mpvue](https://github.com/Meituan-Dianping/mpvue) çš„ç‰¹æ€§ï¼Œé—´æ­‡æ€§çš„è¸©é›·ï¼Œä»¥åŠ `code once, run everywhere` çš„å¹»æƒ³ã€‚åªæƒ³ç»™å°ç¨‹åºå¼€å‘æ’ä¸Šæ•ˆç‡çš„ç¿…è†€ ~

## åŠŸèƒ½ç‰¹æ€§

1. Async/Await æ”¯æŒ
2. Javascript ES2017+ è¯­æ³•
3. åŸç”Ÿå°ç¨‹åºæ‰€æœ‰åŠŸèƒ½ï¼Œæ— éœ€å­¦ä¹ ï¼Œææ˜“ä¸Šæ‰‹
4. å¾®ä¿¡æ¥å£ Promise åŒ–
5. æ”¯æŒå®‰è£… NPM åŒ…
6. æ”¯æŒ SCSS(æˆ– LESS) ä»¥åŠ å°äº 16k çš„ background-image
7. æ”¯æŒ source map, æ–¹ä¾¿è°ƒè¯•
8. æ·»åŠ æ–°é¡µé¢æˆ–æ–°ç»„ä»¶æ— éœ€é‡å¯ç¼–è¯‘
9. å…è®¸è‡ªå®šä¹‰ç¼–è¯‘æµç¨‹
10. è‡ªåŠ¨å…¼å®¹æ—§ç‰ˆæœ¬æ‰‹æœºä¸­çš„æ˜¾ç¤ºæ ·å¼
11. æ”¯æŒ WXSS å’Œ SCSS(æˆ– LESS) æ··ç”¨
12. ä»£ç æ··æ·†åŠé«˜åº¦å‹ç¼©ï¼ŒèŠ‚çœåŒ…å¤§å°
13. Typescript æ”¯æŒ
14. æ”¯æŒè½¬æ¢æˆ ç™¾åº¦ / å­—èŠ‚è·³åŠ¨ / æ”¯ä»˜å® å°ç¨‹åº
15. å¤šç§å°ç¨‹åºå¼€å‘æ’ä»¶ï¼Œä¸ºå°ç¨‹åºå¼€å‘å‡è´Ÿï¼Œè§£æ”¾ç”Ÿäº§åŠ›

æ›´å¤šç‰¹æ€§æ­£åœ¨èµ¶æ¥ ... æ•¬è¯·æœŸå¾… ğŸ‘‡

+ å¯è·¨é¡¹ç›®å¤ç”¨çš„å°ç¨‹åºç»„ä»¶æˆ–é¡µé¢ï¼ˆé€šè¿‡NPMåŒ…ç®¡ç†ï¼‰
+ Redux æ”¯æŒ
+ Mixin æ”¯æŒ

## å®‰è£…

***éœ€è¦ node ç‰ˆæœ¬ >= 10.13***

```bash
npm i -g ewa-cli æˆ–è€… yarn global add ewa-cli
```

## å¦‚ä½•ä½¿ç”¨

### åˆ›å»ºæ–°é¡¹ç›®

```bash
ewa new your_project_name
```

### é›†æˆåˆ°ç°æœ‰å°ç¨‹åºé¡¹ç›®ï¼Œä»…æ”¯æŒå°ç¨‹åºåŸç”Ÿå¼€å‘é¡¹ç›®è½¬æ¢

***æ³¨æ„ï¼šä½¿ç”¨æ­¤æ–¹æ³•ï¼Œè¯·åŠ¡å¿…å¯¹é¡¹ç›®ä»£ç åšå¥½å¤‡ä»½ï¼ï¼ï¼***

```bash
cd your_project_dir && ewa init
```

### å¯åŠ¨

è¿è¡Œ `npm start` å³å¯å¯åŠ¨å®æ—¶ç¼–è¯‘

è¿è¡Œ `npm run build` å³å¯ç¼–è¯‘çº¿ä¸Šç‰ˆæœ¬ï¼ˆç›¸æ¯”å®æ—¶ç¼–è¯‘è€Œè¨€ï¼Œå»é™¤äº† source map å¹¶å¢åŠ äº†ä»£ç å‹ç¼©æ··æ·†ç­‰ï¼Œä½“ç§¯æ›´å°ï¼‰

ä¸Šè¿°å‘½ä»¤è¿è¡ŒæˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ°æœ¬åœ°å¤šäº†ä¸ª `dist` ç›®å½•ï¼Œè¿™ä¸ªç›®å½•é‡Œå°±æ˜¯ç”Ÿæˆçš„å°ç¨‹åºç›¸å…³ä»£ç ã€‚

ä½¿ç”¨[å¾®ä¿¡å¼€å‘è€…å·¥å…·](https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/devtools.html)é€‰æ‹© `dist` ç›®å½•æ‰“å¼€ï¼Œå³å¯é¢„è§ˆé¡¹ç›®

### ç›®å½•ç»“æ„

```
â”œâ”€â”€ .ewa                         ç‰¹æ®Šå ä½ç›®å½•ï¼Œç”¨äºæ£€æŸ¥æ˜¯å¦ä¸º ewa é¡¹ç›®
â”œâ”€â”€ dist                         å°ç¨‹åºè¿è¡Œä»£ç ç›®å½•ï¼ˆè¯¥ç›®å½•ç”±ewaçš„start æˆ–è€… buildæŒ‡ä»¤è‡ªåŠ¨ç¼–è¯‘ç”Ÿæˆï¼Œè¯·ä¸è¦ç›´æ¥ä¿®æ”¹è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼‰
â”œâ”€â”€ node_modules                 å¤–éƒ¨ä¾èµ–åº“
â”œâ”€â”€ src                          ä»£ç ç¼–å†™çš„ç›®å½•ï¼ˆè¯¥ç›®å½•ä¸ºä½¿ç”¨ewaåçš„å¼€å‘ç›®å½•ï¼‰
â”‚Â Â  â”œâ”€â”€ components               å°ç¨‹åºç»„ä»¶ç›®å½•
â”‚Â Â  â”œâ”€â”€ pages                    å°ç¨‹åºé¡µé¢ç›®å½•
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.js
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.wxml
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ index.wxss
â”‚Â Â  â”‚Â Â  â””â”€â”€ logs
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ logs.js
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ logs.json
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ logs.wxml
â”‚Â Â  â”‚Â Â      â””â”€â”€ logs.wxss
â”‚Â Â  â”œâ”€â”€ templates                å°ç¨‹åºæ¨¡ç‰ˆç›®å½•
â”‚Â Â  â”œâ”€â”€ utils
â”‚Â Â  â”‚Â Â  â””â”€â”€ util.js
â”‚Â Â  â”œâ”€â”€ app.js                   å°ç¨‹åºå…¥å£æ–‡ä»¶
â”‚Â Â  â”œâ”€â”€ app.json                 å°ç¨‹åºå…¨å±€é…ç½®æ–‡ä»¶
â”‚Â Â  â”œâ”€â”€ app.wxss                 å°ç¨‹åºå…¨å±€æ ·å¼æ–‡ä»¶
â”‚Â Â  â””â”€â”€ project.config.json      å¾®ä¿¡å¼€å‘è€…å·¥å…·å°ç¨‹åºé¡¹ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ ewa.config.js                ewa é…ç½®æ–‡ä»¶
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .eslintrc.js                 eslint é…ç½®
â””â”€â”€ package.json
```

### å‘½ä»¤è¡Œ

```
# å‘½ä»¤è¡Œæ¦‚è§ˆğŸ‘‡

ewa <cmd> [args]

å‘½ä»¤ï¼š
  ewa new <projectName>       åˆ›å»ºæ–°çš„å¾®ä¿¡å°ç¨‹åºé¡¹ç›®           [åˆ«å: create]
  ewa init                    åœ¨ç°æœ‰çš„å°ç¨‹åºé¡¹ç›®ä¸­åˆå§‹åŒ– EWA
  ewa start                   å¯åŠ¨ EWA å°ç¨‹åºé¡¹ç›®å®æ—¶ç¼–è¯‘         [åˆ«å: dev]
  ewa build                   ç¼–è¯‘å°ç¨‹åºé™æ€æ–‡ä»¶
  ewa clean                   æ¸…ç†å°ç¨‹åºé™æ€æ–‡ä»¶
  ewa upgrade                 å‡çº§ EWA å·¥å…·
  ewa generate <type> <name>  å¿«é€Ÿç”Ÿæˆæ¨¡ç‰ˆ                          [åˆ«å: g]

é€‰é¡¹ï¼š
  -v, --version  å½“å‰ç‰ˆæœ¬å·                                               [å¸ƒå°”]
  -h, --help     è·å–ä½¿ç”¨å¸®åŠ©                                             [å¸ƒå°”]


# å¤šå¹³å°ç¼–è¯‘æ”¯æŒ, é»˜è®¤ä¸º weapp (å¾®ä¿¡å°ç¨‹åº)

# å®æ—¶ç¼–è¯‘å‘½ä»¤ ğŸ‘‡
ewa start

å¯åŠ¨ EWA å°ç¨‹åºé¡¹ç›®å®æ—¶ç¼–è¯‘

é€‰é¡¹ï¼š
  -v, --version  å½“å‰ç‰ˆæœ¬å·                                               [å¸ƒå°”]
  -h, --help     è·å–ä½¿ç”¨å¸®åŠ©                                             [å¸ƒå°”]
  -t, --type     æ„å»ºç›®æ ‡ `weapp` æˆ– `swan` æˆ– `alipay` æˆ– `tt`
            [å­—ç¬¦ä¸²] [å¯é€‰å€¼: "weapp", "swan", "alipay", "tt"] [é»˜è®¤å€¼: "weapp"]

# æ„å»ºå‘½ä»¤ ğŸ‘‡
ewa build

ç¼–è¯‘å°ç¨‹åºé™æ€æ–‡ä»¶

é€‰é¡¹ï¼š
  -v, --version  å½“å‰ç‰ˆæœ¬å·                                               [å¸ƒå°”]
  -h, --help     è·å–ä½¿ç”¨å¸®åŠ©                                             [å¸ƒå°”]
  -t, --type     æ„å»ºç›®æ ‡ `weapp` æˆ– `swan` æˆ– `alipay` æˆ– `tt`
            [å­—ç¬¦ä¸²] [å¯é€‰å€¼: "weapp", "swan", "alipay", "tt"] [é»˜è®¤å€¼: "weapp"]
```

## åŠŸèƒ½æ’ä»¶

### å¾®ä¿¡æ¥å£ Promise åŒ–

```javascript
// å¼•å…¥
const { api } = require('ewa');

// ä¾‹ï¼š
Page({
  async onLoad() {
    let { data } = await api.request({ url: 'http://your_api_endpoint' });
  }
})
```

### enableState æ’ä»¶

```javascript
// åœ¨ app.js ä¸­å¼•å…¥æ’ä»¶ï¼Œå¹¶åˆå§‹åŒ–
require('ewa').enableState();

// ä¸Šè¿°æ’ä»¶ä¼šå¼•å…¥ this.setState æ–¹æ³•ï¼Œåœ¨ Page å’Œ Component ä¸­å‡å¯è°ƒç”¨
// setState æ–¹æ³•ä¼šè‡ªåŠ¨ diff å¹¶ä»…æäº¤æ•°æ®å˜æ›´
// ä¾‹ï¼š
Page({
  data: { a: 1, b: 1, c: { d: 1, e: 1 } }
  async onLoad() {
    // è‡ªåŠ¨ diff å˜åŒ–
    // ç›¸å½“äº this.setData({ b: 2, 'c.d': 2 });
    this.setState({ a: 1, b: 2, c: { d: 2, e: 1 } });
  }
})
```

### createStore æ’ä»¶

ä½¿ç”¨æ–¹æ³•ï¼š ğŸ‘‡

1. åˆ›å»º store:å¯¹ä»»æ„çº¯å¯¹è±¡è°ƒç”¨ createStore ä½¿å…¶å“åº”å¼åŒ–ï¼ˆä»¥ app.js ä¸­ globalData ä¸ºä¾‹ï¼‰

```javascript
// app.js ä¸­å¼•å…¥
const { createStore } = require('ewa');

App({
  ...
  globalData: createStore ({
    a: 'old1',
    b: {
      c: 'old2'
    }
  })
})
```

2. æ”¹å˜globalDataï¼ŒglobalDataä»¥åŠå…¨å±€çŠ¶æ€æ›´æ–°ï¼ˆæ”¯æŒåµŒå¥—å±æ€§å’Œæ•°ç»„ä¸‹æ ‡ä¿®æ”¹ï¼‰

```javascript
// pageA.js
Page({
  data: {
    a: '',
    b: {
      c: ''
    }
  }
})

onLoad() {
  App().globalData.a = 'new1'
  console.log(this.data.a === 'new1')  // true

  App().globalData.b.c = 'new2'
  console.log(this.data.b.c === 'new2') // true
}
```

3. æ³¨å…¥å…¨å±€æ–¹æ³• ä½¿ç”¨ç¤ºä¾‹:

```javascript
this.$on('test', (val) => { console.log(val) })

this.$emit('test', 'value') // 'value'

this.$once // ä½¿ç”¨æ–¹æ³•åŒthis.$on åªä¼šè§¦å‘ä¸€æ¬¡

this.$off('test') // è§£ç»‘å½“å‰å®ä¾‹é€šè¿‡this.$on(...)æ³¨å†Œçš„äº‹ä»¶
```

ä»¥ä¸Šæ–¹æ³•é€‚ç”¨äº
1. é¡µé¢ä¸é¡µé¢
2. é¡µé¢ä¸ç»„ä»¶
3. ç»„ä»¶ä¸ç»„ä»¶

* æ³¨: æ‰€æœ‰é¡µé¢æˆ–ç»„ä»¶é”€æ¯æ—¶ä¼šè‡ªåŠ¨è§£ç»‘æ‰€æœ‰çš„äº‹ä»¶(æ— éœ€ä½¿ç”¨ `this.$off(...)`) *

`this.$set('coinName', 'é‡‘å¸')` æ›´æ–°æ‰€æœ‰é¡µé¢å’Œç»„ä»¶ data ä¸­ 'coinName' çš„å€¼ä¸º 'é‡‘å¸'ï¼ˆæ”¯æŒåµŒå¥—å±æ€§å’Œæ•°ç»„ä¸‹æ ‡ä¿®æ”¹ï¼‰

2020/07 æ›´æ–°

$watch ç›‘å¬é¡µé¢æˆ–ç»„ä»¶ data ä¸­å±æ€§ æ”¯æŒç›‘å¬å±æ€§è·¯å¾„å½¢å¼å¦‚ 'a[1].b'

ä½¿ç”¨ç¤ºä¾‹ï¼š
```
data: {
  prop: '',
  obj: {
    key: ''
  }
},
...
$watch: {
  // æ–¹å¼ä¸€
  'prop': function(newVal, oldVal) {
    ...
  },
  // æ–¹å¼äºŒ
  'obj': {
    handler: function(newVal, oldVal) {
      ...
    },
    deep: Boolean, // æ·±åº¦éå†
    immediate: Boolean // ç«‹å³è§¦å‘
  }
}
```

## é…ç½®

ewa é€šè¿‡ `ewa.config.js` æ¥æ”¯æŒä¸ªæ€§åŒ–é…ç½®ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

``` javascript
// ewa.config.js

module.exports = {
  // å…¬ç”¨ä»£ç åº“ (node_modules æ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶)åç§°ï¼Œé»˜è®¤ä¸º vendors.js
  commonModuleName: 'vendors.js',

  // é€šç”¨æ¨¡å—åŒ¹é…æ¨¡å¼ï¼Œé»˜è®¤ä¸º /[\\/](node_modules|utils|vendor)[\\/].+\.js/
  // å¦‚éœ€æ·»åŠ å¤šä¸ªæ–‡ä»¶å¤¹ï¼Œå¯è‡ªå®šä¹‰æ­£åˆ™ï¼Œå¦‚ /[\\/](node_modules|utils|custom_dirname)[\\/].+\.js/
  commonModulePattern: /[\\/](node_modules|utils|vendor)[\\/].+\.js/,

  // æ˜¯å¦ç®€åŒ–è·¯å¾„ï¼Œä½œç”¨äº page å’Œ componentï¼Œå¦‚ index/index.wxml=> index.wxmlï¼Œé»˜è®¤ä¸º false
  simplifyPath: false,

  // æ–‡ä»¶å¤¹å¿«æ·å¼•ç”¨
  aliasDirs: [
    'apis',
    'assets',
    'constants',
    'utils'
  ],

  // éœ€è¦æ‹·è´çš„æ–‡ä»¶ç±»å‹
  copyFileTypes: [
    'png',
    'jpeg',
    'jpg',
    'gif',
    'svg',
    'ico'
  ],

  // webpack loader è§„åˆ™
  rules: [],

  // webpack æ’ä»¶
  plugins: [],

  // å¼€å‘ç¯å¢ƒä¸‹æ˜¯å¦è‡ªåŠ¨æ¸…ç†æ— ç”¨æ–‡ä»¶ï¼Œé»˜è®¤ä¸º true
  autoCleanUnusedFiles: true,

  // css è§£æå™¨ï¼Œsass æˆ–è€… lessï¼Œé»˜è®¤ä¸º sass
  cssParser: 'sass',

  // æ˜¯å¦å¼€å¯ hashed module id
  hashedModuleIds: true,

  // æ˜¯å¦å¼€å¯ç¼“å­˜ï¼Œé»˜è®¤ä¸º true
  cache: true,

  // å«Œä¸å¤Ÿçµæ´»ï¼Ÿç›´æ¥ä¿®æ”¹ webpack é…ç½®
  webpack: function(config) {
    return config;
  }
};
```

## å¸¸è§é—®é¢˜ & Tips

1. å¯ä»¥ä½¿ç”¨ `@` æ¥ä»£æ›¿ **æºä»£ç æ ¹ç›®å½•** æ¥å¼•å…¥ä»£ç æˆ–æ ·å¼ï¼Œå¦‚ `const utils = require('@/utils/util')`
2. WXSS ä¸­å¯ä»¥ç›´æ¥ç¼–å†™ SCSS æ ·å¼ä»£ç 
3. WXSS æˆ– SCSS ä¸­å¼•ç”¨ç»å¯¹è·¯å¾„éœ€è¦åœ¨è·¯å¾„å‰åŠ  `~` ç¬¦å·ï¼Œå¦‚ï¼š`@import "~@/assets/styles/common.scss";`ï¼Œå…·ä½“åŸå› å‚è§: [sass-loader](https://github.com/webpack-contrib/sass-loader#imports)
4. `ewa build` åå¦‚æœæ— æ³•æ­£å¸¸è¿è¡Œå°ç¨‹åºï¼Œå¯æ£€æŸ¥ä¸‹æ˜¯å¦å…³é—­äº†å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­çš„ `ES6 è½¬ ES5` å’Œ `å¢å¼ºç¼–è¯‘` é€‰é¡¹ã€‚åŸå› æ˜¯ï¼šewa æ‰“åŒ…æ—¶ä¼šå°† ES6 è½¬æ¢ä¸º ES5 å¹¶æ··æ·†å‹ç¼©ï¼Œæ­¤åŠŸèƒ½å’Œå¾®ä¿¡å¼€å‘è€…å·¥å…·è‡ªå¸¦çš„ `ES6 è½¬ ES5` å’Œ `å¢å¼ºç¼–è¯‘` åŠŸèƒ½æœ‰éƒ¨åˆ†é‡å¤ï¼Œå¤šæ¬¡è½¬æ¢ä¼šå¯¼è‡´ä»£ç æ— æ³•è¿è¡Œï¼Œæ‰€ä»¥åªè¦å…³é—­å³å¯ã€‚
